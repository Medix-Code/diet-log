<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OCR Feedback Demo - MisDietas</title>
    <link rel="stylesheet" href="./src/components/OCRFeedback.css" />
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }

      .demo-container {
        max-width: 600px;
        margin: 0 auto;
        background: white;
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }

      h1 {
        color: #004aad;
        margin-bottom: 10px;
      }

      .subtitle {
        color: #666;
        margin-bottom: 30px;
      }

      .demo-buttons {
        display: flex;
        gap: 12px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .demo-btn {
        padding: 12px 24px;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 14px;
      }

      .demo-btn.primary {
        background: #004aad;
        color: white;
      }

      .demo-btn.primary:hover {
        background: #0056b3;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 74, 173, 0.3);
      }

      .demo-btn.secondary {
        background: #f5f5f5;
        color: #333;
      }

      .demo-btn.secondary:hover {
        background: #e9ecef;
      }

      .demo-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .info-box {
        background: #e9f5ff;
        border-left: 4px solid #004aad;
        padding: 16px;
        border-radius: 8px;
        margin-top: 20px;
      }

      .info-box h3 {
        margin: 0 0 8px 0;
        color: #004aad;
        font-size: 14px;
      }

      .info-box p {
        margin: 0;
        color: #666;
        font-size: 13px;
        line-height: 1.6;
      }

      .file-input-wrapper {
        position: relative;
        overflow: hidden;
        display: inline-block;
      }

      .file-input-wrapper input[type="file"] {
        position: absolute;
        left: -9999px;
      }

      code {
        background: #f5f5f5;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <div class="demo-container">
      <h1>üé® OCR Feedback Demo</h1>
      <p class="subtitle">Modern 2025 UX for text recognition</p>

      <div class="demo-buttons">
        <button class="demo-btn primary" onclick="runQuickDemo()">
          ‚ñ∂ Quick Demo (Simulated OCR)
        </button>

        <button class="demo-btn primary" onclick="runDetailedDemo()">
          ‚ö° Detailed Demo (All Phases)
        </button>

        <div class="file-input-wrapper">
          <button class="demo-btn secondary">üìÅ Upload Image</button>
          <input
            type="file"
            accept="image/*"
            onchange="runRealImageDemo(this.files[0])"
          />
        </div>

        <button class="demo-btn secondary" onclick="runErrorDemo()">
          ‚úó Test Error State
        </button>

        <button class="demo-btn secondary" onclick="runWarningDemo()">
          ‚ö† Test Warning State
        </button>
      </div>

      <div class="info-box">
        <h3>üí° Como funciona</h3>
        <p>
          Esta demo muestra el nuevo sistema de feedback para OCR. Observa c√≥mo
          aparece la imagen capturada, c√≥mo se muestran los mensajes de progreso
          en tiempo real, y c√≥mo el sistema hace auto-scroll para mantener
          siempre visible la √∫ltima actualizaci√≥n.
        </p>
      </div>

      <div
        class="info-box"
        style="
          background: #fff8e1;
          border-left-color: #ff9f0a;
          margin-top: 12px;
        "
      >
        <h3>üöÄ Caracter√≠sticas</h3>
        <p>
          ‚úì Vista previa de imagen elegante<br />
          ‚úì Barra de progreso animada<br />
          ‚úì Mensajes en tiempo real con auto-scroll<br />
          ‚úì Dise√±o glass morphism moderno<br />
          ‚úì Micro-interacciones inteligentes<br />
          ‚úì 100% accesible (ARIA, teclado)
        </p>
      </div>
    </div>

    <!-- OCR Feedback Container -->
    <div id="ocr-feedback-root"></div>

    <!-- React & ReactDOM from CDN (for demo) -->
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>

    <!-- Demo Scripts -->
    <script type="module">
      import { getOCRFeedbackManager } from "./src/utils/ocrFeedbackBridge.js";

      const ocr = getOCRFeedbackManager();

      // Make functions global for onclick handlers
      window.runQuickDemo = async function () {
        // Simulate image
        const canvas = document.createElement("canvas");
        canvas.width = 400;
        canvas.height = 300;
        const ctx = canvas.getContext("2d");
        ctx.fillStyle = "#f0f0f0";
        ctx.fillRect(0, 0, 400, 300);
        ctx.fillStyle = "#004aad";
        ctx.font = "bold 24px Arial";
        ctx.textAlign = "center";
        ctx.fillText("Demo Image", 200, 150);

        canvas.toBlob(async (blob) => {
          ocr.start(blob);

          await delay(500);
          ocr.update(20, "Preparando imagen...");

          await delay(800);
          ocr.update(50, "Reconociendo texto...");

          await delay(1000);
          ocr.update(80, "Procesando resultados...");

          await delay(600);
          ocr.complete("‚úì Proceso completado exitosamente");
        });
      };

      window.runDetailedDemo = async function () {
        const canvas = document.createElement("canvas");
        canvas.width = 500;
        canvas.height = 350;
        const ctx = canvas.getContext("2d");

        // Draw more realistic OCR image
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, 500, 350);
        ctx.fillStyle = "#333";
        ctx.font = "16px monospace";
        ctx.fillText("Hora movilizaci√≥n: 10:30", 50, 100);
        ctx.fillText("Hora llegada hospital: 11:45", 50, 150);
        ctx.fillText("Hora final: 12:00", 50, 200);

        canvas.toBlob(async (blob) => {
          ocr.start(blob);

          ocr.addMessage("üîç Fase 1: Preparaci√≥n", "info");
          await delay(400);

          ocr.update(10, "Validando formato de imagen...");
          await delay(300);

          ocr.update(15, "Comprobando tama√±o...");
          await delay(250);

          ocr.update(20, "Eliminando metadatos EXIF...");
          await delay(400);

          ocr.addMessage("‚ú® Fase 2: Mejora de calidad", "info");
          await delay(300);

          ocr.update(35, "Aplicando filtros de contraste...");
          await delay(500);

          ocr.update(45, "Optimizando para OCR...");
          await delay(400);

          ocr.addMessage("ü§ñ Fase 3: Reconocimiento", "info");
          await delay(300);

          ocr.update(55, "Inicializando Tesseract...");
          await delay(600);

          ocr.update(70, "Detectando l√≠neas de texto...");
          await delay(700);

          ocr.update(85, "Convirtiendo a texto estructurado...");
          await delay(600);

          ocr.addMessage("‚úì Fase 4: Validaci√≥n", "info");
          await delay(300);

          ocr.update(90, "Validando horas extra√≠das...");
          await delay(400);

          ocr.update(95, "Completando formulario...");
          await delay(500);

          ocr.complete("‚úì 3 campos completados exitosamente");
        });
      };

      window.runRealImageDemo = async function (file) {
        if (!file) return;

        ocr.start(file);

        await delay(400);
        ocr.update(15, "Validando imagen...");

        await delay(500);
        ocr.update(30, "Mejorando calidad...");

        await delay(700);
        ocr.update(60, "Reconociendo texto...");

        await delay(900);
        ocr.update(85, "Procesando resultados...");

        await delay(400);
        ocr.complete("‚úì Imagen procesada correctamente");
      };

      window.runErrorDemo = async function () {
        const canvas = document.createElement("canvas");
        canvas.width = 300;
        canvas.height = 200;
        const ctx = canvas.getContext("2d");
        ctx.fillStyle = "#ffcccc";
        ctx.fillRect(0, 0, 300, 200);
        ctx.fillStyle = "#dc3545";
        ctx.font = "bold 20px Arial";
        ctx.textAlign = "center";
        ctx.fillText("Error Simulation", 150, 100);

        canvas.toBlob(async (blob) => {
          ocr.start(blob);

          await delay(400);
          ocr.update(20, "Preparando imagen...");

          await delay(600);
          ocr.update(50, "Intentando reconocer texto...");

          await delay(800);
          ocr.error("‚úó No se pudo leer el texto. La imagen no es clara.");
        });
      };

      window.runWarningDemo = async function () {
        const canvas = document.createElement("canvas");
        canvas.width = 400;
        canvas.height = 250;
        const ctx = canvas.getContext("2d");
        ctx.fillStyle = "#fff8e1";
        ctx.fillRect(0, 0, 400, 250);
        ctx.fillStyle = "#ff9f0a";
        ctx.font = "bold 18px Arial";
        ctx.textAlign = "center";
        ctx.fillText("Warning Test", 200, 125);

        canvas.toBlob(async (blob) => {
          ocr.start(blob);

          await delay(400);
          ocr.update(30, "Procesando imagen...");

          await delay(600);
          ocr.update(60, "Reconociendo texto...");

          await delay(500);
          ocr.warning("‚ö† Solo se detectaron 2 de 3 campos");

          await delay(400);
          ocr.update(85, "Completando campos detectados...");

          await delay(500);
          ocr.complete("‚úì Completado - Revisa los campos en amarillo");
        });
      };

      function delay(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }

      console.log("‚úÖ OCR Feedback Demo Ready!");
      console.log("Click any button to see the component in action.");
    </script>
  </body>
</html>
